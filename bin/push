#!/usr/bin/env bash

# -e  Exit immediately if a command exits with a non-zero status.
set -e

if [ -z "$REGISTRY_HOST" ] || [[ "$REGISTRY_HOST" == *"docker.io"* ]]; then
  docker login -u "$REGISTRY_USERNAME" -p "$REGISTRY_PASSWORD"
else
  docker login -u "$REGISTRY_USERNAME" -p "$REGISTRY_PASSWORD" "$REGISTRY_HOST"
fi

docker images

docker-compose push

if [ -z "$REGISTRY_HOST" ] || [[ "$REGISTRY_HOST" == *"docker.io"* ]]; then
  docker logout
else
  docker logout "$REGISTRY_HOST"
fi
